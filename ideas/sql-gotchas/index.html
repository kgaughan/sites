<!DOCTYPE html>

<html lang="en" dir="ltr">
	<head>
		<title>
			SQL gotchas - Stereochrome
		</title>

		<meta name="Author" content="Keith Gaughan">
		<meta name="Copyright" content="Copyright (c) Keith Gaughan, 2001-2019">

		<link rel="shortcut icon" type="image/x-icon" href="https://stereochro.me/favicon.ico"><link rel="stylesheet" type="text/css" media="screen" href="https://stereochro.me/assets/screen.css"><link rel="stylesheet" type="text/css" media="print" href="https://stereochro.me/assets/print.css">
<link rel="stylesheet" type="text/css" media="screen" href="https://stereochro.me/assets/prettify.css">

		<style type="text/css" media="handheld">
		#content, #footer, #masthead {
			width: 22em;
			font-size: 200%;
		}
		</style>
	</head>
	<body class="">
		<div id="masthead"><a href="https://stereochro.me/">stereochro<span>me</span></a></div>
		<div id="outer1">
			<div id="content">
				
		<h1>SQL gotchas</h1>

	<p>I&#8217;ve been reviewing some SQL queries recently, and I&#8217;ve noticed some things that people do that lead to far from optimal performance. Here&#8217;s a few, and what people should be doing.</p>

<h2><code>COUNT(*)</code> vs. <code>COUNT(col)</code></h2>

<p>At first blush, these may seem the same, but they actually mean very different things. <code>COUNT(*)</code> will aggregate the number of rows in the result set or group, whereas <code>COUNT(col)</code> will give you the number of non-null values that column has in the current result set or group. You almost always want <code>COUNT(*)</code>. If you don&#8217;t know which you want, use <code>COUNT(*)</code>. Treat that like it&#8217;s the law.</p>

<p>If you&#8217;re thinking that this isn&#8217;t a big deal, keep in mind that <code>COUNT(*)</code> requires much work on the part of the DBMS than <code>COUNT(col)</code>; the value of <code>COUNT(*)</code> falls naturally out of what the DBMS is doing whereas <code>COUNT(col)</code> requires the DBMS to keep track of an extra counter for non-null values for that column.</p>

<h2>Applying functions to fields you&#8217;re searching against</h2>

<p>Say you have a big table, and you want to get all the rows whose <code>created</code> fields is between two dates. <code>created</code> is indexed. If you were to try this:</p>

<pre class="prettyprint"><code>SELECT id, title, created
FROM   entries
WHERE  (TO_DAYS(NOW()) - TO_DAYS(created)) &gt; ? AND (TO_DAYS(NOW()) - TO_DAYS(created)) &lt;= ?;
</code></pre>

<p>You&#8217;re going to subject the DBMS to doing a full table scan just to get those entries. The reason for this is <code>TO_DAYS(created)</code>. By doing this, you prevent the DBMS from using the index on <code>created</code>. It&#8217;s easy enough to rearrange this to work a lot better:</p>

<pre class="prettyprint"><code>SELECT id, title, created
FROM   entries
WHERE  created BETWEEN CURRENT_DATE + INTERVAL ? DAY AND CURRENT_DATE + INTERVAL ? DAY;
</code></pre>

<p>It&#8217;s a simple change, but now the DBMS is able to make effective use of the index.</p>

	<div id="metadata">
		Created at 14:58 UTC on September 8th, 2010					and last modified at 17:40 UTC on September 8th, 2010			</div>
				</div>
		</div>
		<div id="outer2">
			<div id="footer">
				<hr>
				<a href="http://en.wikipedia.org/wiki/Hacker_(programmer_subculture)"><img src="https://stereochro.me/assets/images/glider.png" style="float:right" width="55" height="55" alt="Hacker"></a>
								<ul id="nav">
					<li><a href="https://stereochro.me/">Home</a></li>
					<li><a href="https://stereochro.me/about">About</a></li>
					<li><a href="https://stereochro.me/weblog/">Weblog</a></li>
					<li><a href="https://stereochro.me/projects">Projects</a></li>
					<li><a href="https://stereochro.me/colophon">Colophon</a></li>
					<li><a href="https://stereochro.me/sitemap">Sitemap</a></li>
				</ul>
				<address>
					Copyright &copy; Keith Gaughan, 2001&#8210;2019.
					All Rights Reserved.
					You can stop reading now.
				</address>
				<p>
<a href="//ipv6ready.ie/verify/d64e5fedaefdb41b1a0b198d4a4faa7a3cf832de">
  <img width="120" height="20"
	src="//d-badges.ipv6ready.ie/d/64/e5/fe/d64e5fedaefdb41b1a0b198d4a4faa7a3cf832de-s.png"
	alt="[IPv6 Ready]">
</a>
				</p>
			</div>
		</div>
		<script type="text/javascript" src="https://stereochro.me/assets/prettify.js"></script>
<script type="text/javascript">prettyPrint();</script>			</body>
</html>
