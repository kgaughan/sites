<!DOCTYPE html>
<html lang="en"><head>

		<title>Detecting broken images with JavaScript</title>

	<meta charset="utf-8">

	<link rel="stylesheet" type="text/css" href="https://i.canthack.it/theme/css/style.css">
	<link rel="stylesheet" type="text/css" href="https://i.canthack.it/theme/css/pygments.css">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:500,400|Inconsolata|Oswald:400&amp;subset=latin-ext" rel="stylesheet" type="text/css">
	<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">

		<link href="https://i.canthack.it/feeds/all.xml" type="application/atom+xml" rel="alternate" title="Can’t Hack It Atom Feed">

</head><body>

<section class="sidebar">
	<div class="sidebar-content">
		<figure id="user-logo">
			<a href="https://i.canthack.it"><div class="logo">&nbsp;</div></a>
		</figure>

		<div class="user-meta">
			<h1 id="user"><a href="https://i.canthack.it">Can’t Hack It</a></h1>
			<h2>...but trying to</h2>


			<ul>
						<li><a href="https://i.canthack.it/pages/about.html">About</a></li>
						<li><a href="https://i.canthack.it/pages/conlanging.html">Conlanging</a></li>
				<li><a href="https://i.canthack.it/categories.html">Categories</a></li>
				<li><a href="/">Main site</a></li>
				<li><a href="https://github.com/kgaughan/">Github</a></li>
				<li><a href="https://twitter.com/talideon/">Twitter</a></li>
			</ul>
		</div>
	</div>
</section>

<section class="posts">
<article>
<h1 class="title">
	<a href="https://i.canthack.it/detecting-broken-images-js.html" rel="bookmark"
		title="Permalink to Detecting broken images with JavaScript">Detecting broken images with&nbsp;JavaScript</a>
</h1>
<div class="published" title="2005-02-22T16:24:00+00:00">Tue 22 February 2005</div>

<div class="entry-content"><div class="admonition note">
<p class="admonition-title">Note</p>
<p>A cache of the original can be found <a href="https://web.archive.org/web/20091227154326/http://talideon.com/weblog/2005/02/detecting-broken-images-js.cfm">here</a>.</p>
</div>
<p>I hit an annoying problem with a project at work. It&#8217;s not my fault, there&#8217;s nothing wrong with the code, but sometimes things will happen: people will delete images out of the backend, not upload the image they&#8217;ve given, or will be referencing an image on another server. Welcome to a plague of broken&nbsp;images.</p>
<p>So how to cope with this? Your guess is as good as mine, but for now my solution is to pretend the image isn&#8217;t there at all. Not completely mind you: it occupies a space, but it&#8217;s not&nbsp;shown.</p>
<p>But it&#8217;s not immediately obvious how you check if the images on the page have loaded ok or not. After a few minutes of hacking, here&#8217;s the most transparent method I could come up&nbsp;with:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">IsImageOk</span><span class="p">(</span><span class="nx">img</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// During the onload event, IE correctly identifies any images that</span>
    <span class="c1">// weren&#39;t downloaded as not complete. Others should too. Gecko-based</span>
    <span class="c1">// browsers act like NS4 in that they report this incorrectly.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">img</span><span class="p">.</span><span class="nx">complete</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// However, they do have two very useful properties: naturalWidth and</span>
    <span class="c1">// naturalHeight. These give the true size of the image. If it failed</span>
    <span class="c1">// to load, either of these should be zero.</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">img</span><span class="p">.</span><span class="nx">naturalWidth</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">img</span><span class="p">.</span><span class="nx">naturalWidth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// No other way of checking: assume it&#39;s ok.</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>There&#8217;s half the work done. Now for the other half. When the page loads, we run over the <code>images[]</code> array to check them&nbsp;all.</p>
<div class="highlight"><pre><span></span><span class="nx">AddEvent</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">IsImageOk</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<p>And that <em>should</em> do the&nbsp;trick.</p></div>

<div class="article-meta">
	<div>Category: <a href="https://i.canthack.it/category/coding.html">Coding</a></div>
</div>
</article>
</section>

</body></html>
