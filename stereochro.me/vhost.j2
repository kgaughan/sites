server {
	include common_params;
	include ssl_params;

	server_name {{ domain_name }};
	root {{ vhosts_root }}/{{ domain_name }}/web;
	index index.html;

	rewrite "^/weblog/(%3b|;)feed" https://talideon.com/inklings/feed permanent;
	rewrite "^/weblog(.*)$" https://talideon.com/inklings$1 permanent;

	location = /ideas/ananagyu/ { return 301 https://i.canthack.it/pages/ananagyu.html; }
	location = /ideas/detecting-broken-images-js/ { return 301 https://i.canthack.it/detecting-broken-images-js.html; }
	location = /ideas/formkeys/ { return 301 https://i.canthack.it/formkeys.html; }
	location = /ideas/mosml-pt1/ { return 301 https://i.canthack.it/mosml-pt1.html; }
	location = /ideas/the-weave/ { return 301 https://i.canthack.it/pages/conlanging.html; }
	location = /ideas/rpm-for-the-unwilling/ { return 301 https://i.canthack.it/rpm-for-the-unwilling.html; }
	location = /projects/ { return 301 https://github.com/kgaughan?tab=repositories; }
	location = /projects/elementnode/ { return 301 https://github.com/kgaughan/elementnode; }
	location = /snippets/talideon-wallpaper/ { return 301 https://gist.github.com/kgaughan/d1180cf7bf4adebeaf6498ff499400d0; }
	location = /about/ { return 301 https://i.canthack.it/pages/about.html; }
	location = /ideas/debian-merging-isos/ { return 301 https://i.canthack.it/debian-merging-isos.html; }
	location = /ideas/language-learning/ { return 301 https://i.canthack.it/language-learning.html; }
	location = /ideas/global-in-python/ { return 301 https://i.canthack.it/global-in-python.html; }
	location = /ideas/type-vs-isinstance/ { return 301 https://i.canthack.it/type-vs-isinstance.html; }
	location = /ideas/sql-gotchas/ { return 301 https://i.canthack.it/sql-gotchas.html; }
	location = /ideas/package-management/ { return 301 https://i.canthack.it/package-management.html; }
	location = /ideas/discouraging-clientelism/ { return 301 https://i.canthack.it/discouraging-clientelism.html; }

	add_header Content-Security-Policy "default-src 'self'; img-src https://d-badges.ipv6ready.ie 'self'; script-src 'unsafe-inline' 'self'; style-src https://fonts.googleapis.com 'unsafe-inline' 'self'; font-src https://fonts.gstatic.com 'self'" always;

	ssl_certificate {{ tls_root }}/{{ domain_name }}/fullchain.pem;
	ssl_certificate_key {{ tls_root }}/private/{{ domain_name }}.pem;

	access_log {{ logs_root }}/{{ domain_name }}.access.log combined;
	error_log {{ logs_root }}/{{ domain_name }}.error.log;
}

server {
	include common_params;
	include ssl_params;

	server_name www.{{ domain_name }};
	return 301 https://{{ domain_name }}$request_uri;

	ssl_certificate {{ tls_root }}/{{ domain_name }}/fullchain.pem;
	ssl_certificate_key {{ tls_root }}/private/{{ domain_name }}.pem;
}

server {
	include common_params;

	listen 80;
	listen [::]:80;

	server_name .{{ domain_name }};
	return 301 https://{{ domain_name }}$request_uri;
}
