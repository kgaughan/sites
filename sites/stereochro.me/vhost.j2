server {
	include common_params;
	include php_params;
	include ssl_params;

	server_name stereochro.me;
	root {{ vhosts_root }}/stereochro.me/web;
	index index.html index.htm dispatch.php;

	rewrite "^/weblog/(%3b|;)feed" https://talideon.com/inklings/feed permanent;
	rewrite "^/weblog(.*)$" https://talideon.com/inklings$1 permanent;

	location = /ideas/ananagyu { return 301 https://i.canthack.it/pages/ananagyu.html; }
	location = /ideas/detecting-broken-images-js { return 301 https://i.canthack.it/detecting-broken-images-js.html; }
	location = /ideas/mosml-pt1 { return 301 https://i.canthack.it/mosml-pt1.html; }
	location = /ideas/the-weave { return 301 https://i.canthack.it/pages/conlanging.html; }
	location = /ideas/rpm-for-the-unwilling { return 301 https://i.canthack.it/rpm-for-the-unwilling.html; }

	location /distfiles {
		autoindex on;
		alias {{ vhosts_root }}/stereochro.me/distfiles;
	}

	location /assets/uploads {
		alias {{ vhosts_root }}/stereochro.me/uploads;
	}

	try_files $uri $uri/ /dispatch.php;

	ssl_certificate {{ tls_root }}/stereochro.me/fullchain.pem;
	ssl_certificate_key {{ tls_root }}/private/stereochro.me.pem;

	access_log {{ logs_root }}/stereochro.me.access.log combined;
	error_log {{ logs_root }}/stereochro.me.error.log;
}

server {
	include common_params;
	include ssl_params;

	server_name www.stereochro.me;
	return 301 https://stereochro.me$request_uri;

	ssl_certificate {{ tls_root }}/stereochro.me/fullchain.pem;
	ssl_certificate_key {{ tls_root }}/private/stereochro.me.pem;
}

server {
	include common_params;

	listen 80;
	listen [::]:80;

	server_name .stereochro.me;
	return 301 https://$host$request_uri;
}
